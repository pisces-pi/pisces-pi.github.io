---
title: 砍树效果
date: 2022-02-26 14:56:49
tags: 作品集
math: true
hide: true
---
- 制作一个多个树木的砍伐震动效果
- <img src = '/砍树效果/ChopTree.gif'>
***

# 材质
## 材质函数
### 衰减振荡函数
- 当树木被砍时，应表现为晃动，且晃动的振幅逐渐减弱
- 这里以$f(x)=\frac{n^xsin(2k\pi{x}+\frac{\pi}{2})}{t}$作为衰减振荡函数，其中**n**设为**AttenuationSpeed**、**k**设为**Frequence**、**1 / t**设为**Amplitude**；而函数的输入**x**定义为**ShakeTime**，由外部传入

### 振荡方向与强度
- 定义一个变量**ShakeDirWS**，表示世界空间下的振荡方向
- 为表现树木被砍时，顶端比末端振荡更为剧烈的效果，利用一个通道的顶点色控制，如图所示：<img src = '/砍树效果/VertexColor.png' width='30%'>
- 最后，使衰减函数的计算结果乘上方向和顶点色信息

### 振荡的启用控制
- 设原始的世界空间偏移为**OriWPOS**
- 材质函数的最后添加振荡的启用控制，即令
- ```
  if (IsShake)
  {
      return OriWPOS + ChopTreeFunc(ShakeTime, AttenuationSpeed, Frequence, Amplitude, ShakeDirWS);
  }
  return OriWPOS;
  ```

## 材质函数的应用
- 将ChopTree材质函数置于材质中使用，其中**ShakeTime**、**ShakeDirWS**和**IsShake**为材质参数；**AttenuationSpeed**、**Frequence**和**Amplitude**使用参数集定义和控制；**OriWPOS**则为之前的世界空间偏移作为输入
- 函数的输出结果设置在世界空间偏移即可

# 蓝图
- 蓝图主要用于为材质传参
- 当需要播放砍伐动画时，记录并设置**IsShake**参数
- 每帧判断**IsShake**是否开启，开启则传入材质**ShakeTime**参数，值从0开始线性增大即可；当其值超过一定阈值后，设置**IsShake**关闭即可结束效果